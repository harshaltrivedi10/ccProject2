<html>
    <head>
        <meta content="text/html;charset=utf-8" http-equiv="Content-Type">
        <meta content="utf-8" http-equiv="encoding">
        <title>CC Project 2</title>
        <link rel="stylesheet" href="../static/css/bootstrap.min.css">
        <link rel="stylesheet" href="../static//css/style.css">
        <style>
            @import url('https://fonts.googleapis.com/css2?family=Roboto+Condensed:wght@700&display=swap');
        </style>
        <script
            src="https://code.jquery.com/jquery-3.4.1.min.js"
            integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo="
            crossorigin="anonymous"></script>
        <script src = "../static/js/bootstrap.min.js"></script>
        <script src = "../static/js/index.js"></script>
    </head>
    <body>
        <div class="container">
            <div class="row">
                <div id="heading" class="col-lg-12">
                    <h1>Speaker recognition and Performance Analysis</h1>
                </div>
            </div>

            <div class="row">
                <h2 id="functionalities" class="col-lg-12">
                    Two major functionalities:
                </h2>
            </div>

            <div class="row">
                <div class="col">
                    <h5 class="sectionTitle">
                        Speaker Profile Enrollment
                    </h5>
                </div>
                <div class="col">
                    <h5 class="sectionTitle">
                        Speaker Identification and Performance Evaluation
                    </h5>
                </div>
            </div>

            <div class="row">
                <div class="col">
                    <ul class = "ulTextAlign">
                        Provide a name, indicating the name of a speaker and an audio of at-least 30 seconds and you can:
                        <li>Enroll a speaker</li>
                        <li>Create a dedicated profile for a speaker</li>
                    </ul>
                    <p class="usage">Uses Microsoft's Speaker Profile API and Speaker Enrollment API</p>
                </div>
                <div class="vline"></div>
                <div class="col">
                    <ul class = "ulTextAlign">
                        Provide an audio of at-least 30 seconds of an unknown speaker and this functionality will:
                        <li>Identify the speaker</li>
                        <li>Generates Performance reports of the identified speaker</li>
                    </ul>
                    <p class="usage">Uses Microsoft's Speaker Identification API and Google Speech-To-Text API</p>
                </div>
            </div>

            <div class="row">
                <div class="col">
                    <form class="form-inline">
                        <div class="form-group mb-2">
                            <label for="userName"
                                   class="sr-only">Name: </label>
                            <input class="form-control"
                                   type="text"
                                   style="margin-top: 5em; margin-left:3.2em; margin-right:3.2em"
                                   id="userName"
                                   placeholder="Enter you name:">
                        </div>
                        <div class="form-group mx-sm-3 mb-2">
                            <label class="btn btn-light"
                                   style = "margin-top: 5em; width: 100%;">
                                Browse <input type="file" id = "enrollmentFilePicker" hidden>
                            </label>
                        </div>
                    </form>
                    <div class="row">
                        <button type="button"
                                id = "submitProfileAndIdentification"
                                class="btn btn-primary mb-2"
                                style="margin: auto;"
                                onclick="onSubmitProfileAndEnrollClick(this)">Submit Request</button>
                    </div>
                </div>
                <div class="vl"></div>
                <div id="right" class="col">
                    <form class="form-inline">
                        <div class="form-group mx-sm-3 mb-2">
                            <label class="btn btn-light"
                                   style = "margin-top: 5em; margin-left: 13.2em; margin-right: 13.2em; width: 100%;">
                                Browse <input type="file" id = "identificationFilePicker" hidden>
                            </label>
                        </div>
                    </form>
                    <div class="row" style="align-content: center;">
                        <button type="button"
                                id = "performanceEvaluation"
                                class="btn btn-secondary mb-2"
                                style="margin: auto;"
                                onclick="onGetPerformanceEvaluationClick(this)">Evaluate Performance</button>
                        <button type="button"
                                id = "getReports"
                                class = "btn btn-secondary mb-2"
                                style="margin: auto;"
                                onclick="generateReport()">Get Reports</button>
                    </div>
                </div>
            </div>
        </div>

        <script type="text/javascript">
            window.onload = () => {
                document.querySelector('#userName').value = "";
                document.querySelector('#enrollmentFilePicker').value = null;
                document.querySelector('#identificationFilePicker').value = null;
                console.log(document.querySelector('#enrollmentFilePicker').value);
                console.log(document.querySelector('#userName').value);
            }

            function onSubmitProfileAndEnrollClick() {
                console.log(document.querySelector('#enrollmentFilePicker').value);
                console.log(document.querySelector('#userName').value);
                if (document.querySelector("#userName").value == "" || document.querySelector('#enrollmentFilePicker').value == "") {
                    alert("You either did not select a file or did not enter a name, please try again!");
                    location.reload();
                }
                else {
                    let userName = document.querySelector("#userName").value;
                    let filePicker = document.querySelector('#enrollmentFilePicker');
                    let fileName = filePicker.value;

                    if (fileName.substring(3,11) === 'fakepath') {
                        fileName = fileName.substring(12);
                    }
                    var host = window.location.host
                    console.log(host)
                    submitRequest(fileName, userName, host);
                }
            }

            function onGetPerformanceEvaluationClick() {
                if (document.querySelector('#identificationFilePicker').value == "") {
                    alert("You did not select a file for generating performance report, please try again!");
                    location.reload();
                }
                else {
                    let filePicker = document.querySelector('#identificationFilePicker');
                    let fileName = filePicker.value;

                    if (fileName.substring(3,11) === 'fakepath') {
                        fileName = fileName.substring(12);
                    }
                    var host = window.location.host
                    console.log(host)
                    identifyAndGeneratePerformanceReport(fileName, host);
                }

            }

            function generateReport() {
                var host = window.location.host
                console.log(host)
                generateAndDownloadReport(host)
            }
        </script>
    </body>
</html>